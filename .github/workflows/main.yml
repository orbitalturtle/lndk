name: CI

on:
  push:
    branches: ['master']
  pull_request:
    branches: ['*']

env:
  GO_VERSION: 1.21.0

jobs:
  #build_and_format:
  #  name: LNDK Rust Build
  #  runs-on: ubuntu-latest
  #  steps:
  #    - uses: actions/checkout@v3
  #    - uses: actions-rs/toolchain@v1
  #      with:
  #        toolchain: stable
  #    #- uses: actions-rs/cargo@v1
  #    #  name: cargo build
  #    #  with:
  #    #    command: build
  #    #    args: --release --all-features
  #    # CHANGE THIS TO MOST RECENT VERSION SO LNDS CHANGES DONT EFF THIS UP
  #    - name: setup go ${{ env.GO_VERSION }}
  #      uses: lightningnetwork/lnd/.github/actions/setup-go@master
  #      with:
  #        go-version: '${{ env.GO_VERSION }}'
  #    - name: run unit and itests
  #      run: make itest
  #    #- uses: actions-rs/cargo@v1
  #    #  name: cargo fmt
  #    #  with:
  #    #    command: fmt
  #    #    args: --check
  #    #- uses: actions-rs/cargo@v1
  #    #  name: cargo clippy
  #    #  with:
  #    #    command: clippy
  #    #    args: -- --deny warnings

  ########################
  # run ubuntu integration tests
  ########################
  ubuntu-integration-test:
    name: run ubuntu unit and integration tests 
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
      - name: setup go ${{ env.GO_VERSION }}
        uses: lightningnetwork/lnd/.github/actions/setup-go@v0.16.4-branch
        with:
          go-version: '${{ env.GO_VERSION }}'
      - name: run unit and integration tests
        run: make itest

  #########################
  ## run windows integration test
  #########################
  #windows-integration-test:
  #  name: run windows unit and integration tests
  #  runs-on: windows-latest
  #  steps:
  #    - uses: actions/checkout@v3
  #    - uses: actions-rs/toolchain@v1
  #      with:
  #        toolchain: stable
  #    #- name: print users
  #    #  run: dir C:\Users
  #    #- name: print temp dir plz 
  #    #  run: dir C:\Users\runneradmin\AppData\Local\Temp
  #    - name: setup go ${{ env.GO_VERSION }}
  #      uses: lightningnetwork/lnd/.github/actions/setup-go@master
  #      with:
  #        go-version: '${{ env.GO_VERSION }}'
  #    - name: run unit and integration tests
  #      run: make itest
  #    - name: test that windows thing is built somewhere? x_x;
  #      run: dir C:\Users\runneradmin\AppData\Local\Temp\lndk-tests\bin 

  #coverage:
  #  name: LNDK Code Coverage
  #  runs-on: ubuntu-latest
  #  env:
  #    CARGO_TERM_COLOR: always
  #  steps:
  #    - uses: actions/checkout@v3
  #    - uses: actions-rs/toolchain@v1
  #      with:
  #        toolchain: stable
  #    - name: Install cargo-llvm-cov
  #      uses: taiki-e/install-action@cargo-llvm-cov
  #    - name: Generate code coverage
  #      run: cargo llvm-cov --all-features --workspace --lcov --output-path lcov.info
  #    - name: Upload coverage to Codecov
  #      uses: codecov/codecov-action@v3
  #      with:
  #        files: lcov.info
  #        fail_ci_if_error: true
  #        token: ${{ secrets.CODECOV_TOKEN }}
